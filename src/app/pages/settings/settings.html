<div class="page-pad">

  <div style="margin-bottom:28px;">
    <h1 style="font-family:'Playfair Display',serif;font-size:1.75rem;font-weight:700;color:#fff;margin:0;">Ajustes</h1>
    <p style="color:rgba(255,255,255,0.4);font-size:0.875rem;margin-top:4px;font-family:'DM Mono',monospace;">Configuración de la aplicación</p>
  </div>

  <div style="max-width:520px;display:flex;flex-direction:column;gap:16px;">

    <!-- ── Perfil ─────────────────────────────────────────────────────────── -->
    <div class="card" style="padding:24px;">
      <h3 style="font-size:0.75rem;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.05em;margin:0 0 20px;">
        Perfil
      </h3>

      @if (profileError()) {
        <div style="display:flex;align-items:center;gap:8px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.25);
                    border-radius:10px;padding:10px 14px;color:#f87171;font-size:0.875rem;margin-bottom:16px;">
          <mat-icon style="font-size:16px;width:16px;height:16px;">error_outline</mat-icon>
          {{ profileError() }}
        </div>
      }

      <div style="display:flex;flex-direction:column;gap:12px;">
        <div>
          <label style="display:block;font-size:0.8rem;color:rgba(255,255,255,0.45);font-family:'DM Mono',monospace;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.04em;">
            Nombre
          </label>
          <input class="input-field" type="text" placeholder="Tu nombre"
            [value]="profileName()" (input)="profileName.set($any($event.target).value)">
        </div>

        <div>
          <label style="display:block;font-size:0.8rem;color:rgba(255,255,255,0.45);font-family:'DM Mono',monospace;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.04em;">
            Correo electrónico
          </label>
          <input class="input-field" type="email" placeholder="tu@email.com"
            [value]="profileEmail()" (input)="profileEmail.set($any($event.target).value)">
        </div>

        <button class="btn-primary" style="align-self:flex-end;margin-top:4px;"
          (click)="saveProfile()"
          [disabled]="savingProfile() || !profileDirty()">
          @if (savingProfile()) {
            <mat-icon style="font-size:16px;width:16px;height:16px;animation:spin 1s linear infinite;">refresh</mat-icon>
            Guardando…
          } @else {
            <mat-icon style="font-size:16px;width:16px;height:16px;">save</mat-icon>
            Guardar cambios
          }
        </button>
      </div>
    </div>

    <!-- ── Contraseña ─────────────────────────────────────────────────────── -->
    <div class="card" style="padding:24px;">
      <h3 style="font-size:0.75rem;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.05em;margin:0 0 20px;">
        Cambiar contraseña
      </h3>

      @if (passwordError()) {
        <div style="display:flex;align-items:center;gap:8px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.25);
                    border-radius:10px;padding:10px 14px;color:#f87171;font-size:0.875rem;margin-bottom:16px;">
          <mat-icon style="font-size:16px;width:16px;height:16px;">error_outline</mat-icon>
          {{ passwordError() }}
        </div>
      }

      <div style="display:flex;flex-direction:column;gap:12px;">
        <div>
          <label style="display:block;font-size:0.8rem;color:rgba(255,255,255,0.45);font-family:'DM Mono',monospace;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.04em;">
            Contraseña actual
          </label>
          <input class="input-field" type="password" placeholder="••••••••"
            [value]="currentPwd()" (input)="currentPwd.set($any($event.target).value)">
        </div>

        <div>
          <label style="display:block;font-size:0.8rem;color:rgba(255,255,255,0.45);font-family:'DM Mono',monospace;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.04em;">
            Nueva contraseña
          </label>
          <input class="input-field" type="password" placeholder="Mínimo 6 caracteres"
            [value]="newPwd()" (input)="newPwd.set($any($event.target).value)">
        </div>

        <div>
          <label style="display:block;font-size:0.8rem;color:rgba(255,255,255,0.45);font-family:'DM Mono',monospace;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.04em;">
            Confirmar contraseña
          </label>
          <input class="input-field" type="password" placeholder="••••••••"
            [value]="confirmPwd()" (input)="confirmPwd.set($any($event.target).value)"
            [style.borderColor]="confirmPwd() && newPwd() !== confirmPwd() ? '#f87171' : ''">
          @if (confirmPwd() && newPwd() !== confirmPwd()) {
            <p style="font-size:0.75rem;color:#f87171;margin:4px 0 0;font-family:'DM Mono',monospace;">
              Las contraseñas no coinciden
            </p>
          }
        </div>

        <button class="btn-primary" style="align-self:flex-end;margin-top:4px;"
          (click)="changePassword()"
          [disabled]="savingPwd() || !passwordValid()">
          @if (savingPwd()) {
            <mat-icon style="font-size:16px;width:16px;height:16px;animation:spin 1s linear infinite;">refresh</mat-icon>
            Cambiando…
          } @else {
            <mat-icon style="font-size:16px;width:16px;height:16px;">lock_reset</mat-icon>
            Cambiar contraseña
          }
        </button>
      </div>
    </div>

    <!-- ── Datos ──────────────────────────────────────────────────────────── -->
    <div class="card" style="padding:24px;">
      <h3 style="font-size:0.75rem;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.05em;margin:0 0 20px;">
        Gestión de Datos
      </h3>

      <div style="display:flex;flex-direction:column;gap:10px;">
        <!-- Export JSON -->
        <button class="btn-primary" style="width:100%;justify-content:center;"
          (click)="exportJson()" [disabled]="exportingJson()">
          @if (exportingJson()) {
            <mat-icon style="font-size:18px;width:18px;height:18px;animation:spin 1s linear infinite;">refresh</mat-icon> Exportando…
          } @else {
            <mat-icon style="font-size:18px;width:18px;height:18px;">download</mat-icon> Exportar datos JSON
          }
        </button>

        <!-- Export CSV -->
        <button style="width:100%;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 24px;
            background:rgba(20,184,166,0.08);border:1px solid rgba(20,184,166,0.2);
            border-radius:10px;color:#2dd4bf;cursor:pointer;font-family:'Sora',sans-serif;
            font-size:0.9rem;font-weight:600;transition:all .2s;"
          (click)="exportCsv()" [disabled]="exportingCsv()"
          onmouseover="this.style.background='rgba(20,184,166,0.15)'"
          onmouseout="this.style.background='rgba(20,184,166,0.08)'">
          @if (exportingCsv()) {
            <mat-icon style="font-size:18px;width:18px;height:18px;animation:spin 1s linear infinite;">refresh</mat-icon> Exportando…
          } @else {
            <mat-icon style="font-size:18px;width:18px;height:18px;">table_chart</mat-icon> Exportar datos CSV
          }
        </button>

        <!-- Import JSON -->
        <button style="width:100%;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 24px;
            background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);
            border-radius:10px;color:rgba(255,255,255,0.5);cursor:pointer;font-family:'Sora',sans-serif;
            font-size:0.9rem;transition:all .2s;"
          (click)="triggerImport()" [disabled]="importing()"
          onmouseover="this.style.borderColor='#14b8a6';this.style.color='#fff'"
          onmouseout="this.style.borderColor='rgba(255,255,255,0.12)';this.style.color='rgba(255,255,255,0.5)'">
          @if (importing()) {
            <mat-icon style="font-size:18px;width:18px;height:18px;animation:spin 1s linear infinite;">refresh</mat-icon> Importando…
          } @else {
            <mat-icon style="font-size:18px;width:18px;height:18px;">upload</mat-icon> Importar datos JSON
          }
        </button>
        <input type="file" id="import-input" accept=".json" style="display:none;" (change)="onImport($event)">
      </div>
    </div>

    <!-- ── Acerca de ───────────────────────────────────────────────────────── -->
    <div class="card" style="padding:24px;">
      <h3 style="font-size:0.75rem;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.05em;margin:0 0 16px;">
        Acerca de
      </h3>
      <p style="color:rgba(255,255,255,0.5);font-size:0.875rem;margin:0;">Finance Tracker v1.0</p>
      <p style="color:rgba(255,255,255,0.3);font-size:0.75rem;margin:4px 0 0;font-family:'DM Mono',monospace;">
        Desarrollado con <app-icon class="text-red-500" [icon]="'heart'" [size]="12" /> por
        <a href="https://juliopoveda.com" target="_blank"
          style="color:#2dd4bf;text-decoration:none;"
          title="Hi Everyone!, I'm Julio Poveda a Senior .NET Developer from Medellin, Colombia.">Julio Poveda</a>
      </p>
    </div>

  </div>
</div>

<style>
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
</style>
